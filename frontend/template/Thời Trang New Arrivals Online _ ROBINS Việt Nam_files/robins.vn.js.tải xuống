







	








var gwStat = {
	meta:null,
	pixelId:"2ba19624-4edd-4c25-8c4c-7fc8aa4a2db6",
	sessionId:"c7c58a4e-a475-47a2-b9b4-aef12be8c3b7",
	data:null,
	domain:"robins.vn",
	base:"https://mailrecipe-live.appspot.com",
	update:function(dt){},
	send:function(){},
	getSessionId:function()
	{
		var sessId = gwReadCookie("gwMailrecipeId");
		sessId = sessId&&sessId.trim()==""?null:sessId;
		if(sessId)
			return sessId;
		else
		{
			gwCreateCookie("gwMailrecipeId",  mailrecipe.sessionId, 1/24);
			return mailrecipe.sessionId;
		}
	},
	fill:function()
	{
		var prms = {};
		var fth = this.meta.fetch;
		for(var mkey in fth)
		{
			try {
				var mval = fth[mkey];
				var vl = mval["get"]();
				prms[mkey] = vl;
			}
			catch (e) {
				console.error("Invalid value for "+mkey+". Reason: "+e);
			}
		}
		prms.sessionId = mailrecipe.getSessionId();
		if(window.sessionStorage)
		{
			var prevpxl = sessionStorage.getItem('gwPrevPixelId');
			if(prevpxl)
				prms.prevPixelId = prevpxl;
			sessionStorage.setItem('gwPrevPixelId', gwStat.pixelId);
		}
		this.data = prms;
	}
};
var mailrecipe = gwStat;

function gwCreateCookie(name, value, days) {
	if (days) {
		var date = new Date();
		date.setTime(date.getTime()+(days*24*60*60*1000));
		var expires = "; expires="+date.toGMTString();
	}
	else var expires = "";
	document.cookie = name+"="+value+expires+"; path=/";
}

function gwReadCookie(k){return(document.cookie.match('(^|; )'+k+'=([^;]*)')||0)[2]}

function gwPost(prms) {
	var postdata = "callback=gwCallback";
	if(prms)
		prms.pixelId = gwStat.pixelId;
	for(var nm in prms)
		if(prms[nm])
			postdata += "&"+nm+"="+encodeURIComponent(prms[nm]);
	postdata += "&nocache="+new Date().getTime();
	var scriptEl = document.createElement('script');
	var endurl = gwStat.base+"/send/"+gwStat.domain+"?"+postdata;
	scriptEl.setAttribute("src", endurl);
	document.body.appendChild(scriptEl);
}

function gwCallback(rslt) {
	if(gwStat.meta.callback && gwStat.meta.callback.get){
		try{
			gwStat.meta.callback.get(rslt);
		}
		catch(err) {
		}
	}
}

function gwDataLayer(nm, obj) {
	var ctx = obj?obj:dataLayer;
	if(ctx && ctx.constructor == Array)
	{
		for(var i = 0; i < ctx.length; i++)
		{
			var dtlyr = ctx[i];
			if(dtlyr[nm])
				return dtlyr[nm];
			else if(dtlyr && (dtlyr.constructor == Array || dtlyr.constructor == Object))
			{
				var val = gwDataLayer(nm, dtlyr);
				if(val) return val;
			}
		}
	}
	else if(ctx && ctx.constructor == Object)
	{
		if(ctx[nm])
			return ctx[nm];
		for(var ctxnm in ctx)
		{
			var ctxval = ctx[ctxnm];
			if(ctxval && (ctxval.constructor == Array || ctxval.constructor == Object))
			{
				var val = gwDataLayer(nm, ctxval);
				if(val) return val;
			}
		}
	}
	return null;
}

function gwVisit() {
	gwStat.fill();
	if(typeof gwStat.data.url=='undefined' || gwStat.data.url==null)
	{
		gwStat.data.url = window.location.href;
		gwStat.data.type = gwHasBought(gwStat.data.url)?'checkout':'ovisit';
	}
	else if(gwStat.data.title && gwStat.data.image && gwStat.data.category && gwStat.data.price)
		gwStat.data.type = 'visit';
	else
		gwStat.data.type = gwHasBought(gwStat.data.url)?'checkout':'ovisit';
	gwPost(gwStat.data);
	return true;
}

function gwCart(dynurl) {
	var url = dynurl?dynurl:gwStat.meta.fetch.url.get();
	if(url)
	{
		var prms = {"url":url, "type":"cart", "sessionId":mailrecipe.getSessionId()};
		gwPost(prms);
	}
}

function gwHasBought(url) {
	return url&&gwStat.meta.checkout&&gwStat.meta.checkout.url&&gwStat.meta.checkout.url.success&&url.indexOf(gwStat.meta.checkout.url.success)>=0?true:false;
}

function gwBought() {
	var prms = {"url":window.location.href, "type":"checkout", "sessionId":mailrecipe.getSessionId()};
	gwPost(prms);
}

function gwEncode(str) {
	var encarr = [];
	for(var i = 0; i < str.length; i++)
		encarr.push(str.charCodeAt(i));
	return encarr.join(",");
}

function gwDecode(str) {
	var deccarr = [];
	var arr = eval("(["+str+"])");
	for(var i = 0; i < arr.length; i++)
		deccarr.push(String.fromCharCode(arr[i]));
	return deccarr.join("");
}

function gwHashCode(str) {
  var hash = 0, i, chr, len;
  if (str.length === 0) return hash;
  for (i = 0, len = str.length; i < len; i++) {
    chr   = str.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0; // Convert to 32bit integer
  }
  return hash;
};

if(!console) console = {log:function(){}, dir:function(){}, error:function(){}};




